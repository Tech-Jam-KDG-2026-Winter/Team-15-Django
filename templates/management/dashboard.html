{% extends 'management/base.html' %}

{% block content %}
<section class="dashboard-section">
    <h2 class="section-title">ダッシュボード</h2>

    <!-- KPI Cards -->
    <div class="card-container" style="--grid-min-width: 200px; margin-bottom: 32px;">
        <div class="menu-card" style="background-color: var(--color-secondary); color: white;">
            <h3 style="color: white; font-size: 1rem;">総ユーザー数</h3>
            <p style="font-size: 2rem; font-weight: 800; color: white; margin-bottom: 4px;">{{ total_users }}</p>
            <small>（直近30日: +{{ new_users_30d }}）</small>
        </div>
        <div class="menu-card" style="background-color: var(--color-primary); color: white;">
            <h3 style="color: white; font-size: 1rem;">体調ログ蓄積数</h3>
            <p style="font-size: 2rem; font-weight: 800; color: white; margin-bottom: 4px;">{{ total_logs }}</p>
        </div>
        <div class="menu-card" style="background-color: #3b82f6; color: white;">
            <h3 style="color: white; font-size: 1rem;">運動メニュー数</h3>
            <p style="font-size: 2rem; font-weight: 800; color: white; margin-bottom: 4px;">{{ total_exercises }}</p>
        </div>
    </div>

    <h2 class="section-title">最近のアクティビティ</h2>
    <div class="card-container" style="grid-template-columns: 2fr 1fr; align-items: flex-start;">
        <!-- Recent Logs Table -->
        <div class="menu-card" style="padding: 0;">
            <div style="padding: 20px; border-bottom: 1px solid var(--color-border);">
                <h3 style="font-size: 1.25rem; margin: 0;">最近の体調ログ</h3>
            </div>
            <div style="padding: 20px;">
                <div class="table-responsive-wrapper">
                    <table class="management-table">
                        <thead>
                            <tr>
                                <th>日付</th>
                                <th>ユーザー</th>
                                <th>疲れ</th>
                                <th>気分</th>
                                <th>悩み</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in recent_logs %}
                            <tr>
                                <td>{{ log.log_date }}</td>
                                <td>{{ log.user.username }}</td>
                                <td>{{ log.fatigue_level }}</td>
                                <td>{{ log.mood_level }}</td>
                                <td>{{ log.body_concern|truncatechars:20 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px;">データがありません</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Simple Chart Placeholder -->
        <div class="menu-card">
            <h3 style="font-size: 1.25rem;">システム情報</h3>
            <p>Status: <span class="tag-badge" style="background-color: #d1fae5; color: #065f46;">Normal</span></p>
            <p>Ver: 1.0.0</p>
            <p>最終更新: 今</p>
        </div>
    </div>
</section>
{% endblock %}
