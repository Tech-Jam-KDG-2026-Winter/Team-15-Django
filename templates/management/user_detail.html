{% extends 'management/base.html' %}

{% block content %}
<section class="management-detail-section">
    <div class="management-header">
        <h2 class="section-title">ユーザー詳細: {{ target_user.username }}</h2>
        <div class="management-actions">
            <a href="{% url 'management:user_list' %}" class="btn-management">一覧に戻る</a>
        </div>
    </div>

    <div class="card-container" style="grid-template-columns: 1fr 1fr; align-items: flex-start;">
        <div class="menu-card">
            <h3>ユーザー情報 / 権限設定</h3>
            <div class="user-info-grid">
                <p><strong>Email:</strong> {{ target_user.email }}</p>
                <p><strong>登録日:</strong> {{ target_user.date_joined }}</p>
                <p><strong>最終ログイン:</strong> {{ target_user.last_login }}</p>
            </div>
            
            <hr style="margin: 20px 0;">
            
            <form method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label class="form-check-label">
                        {{ form.is_staff }}
                        管理者権限 (is_staff)
                    </label>
                    <p class="form-text">管理画面へのアクセス権限を付与します。</p>
                </div>
                <div class="form-group">
                    <label class="form-check-label">
                        {{ form.is_active }}
                        アクティブ (is_active)
                    </label>
                    <p class="form-text">チェックを外すとユーザーはログインできなくなります。</p>
                </div>
                
                <button type="submit" class="btn-management-primary" style="width: 100%;">権限を更新</button>
            </form>
        </div>

        <div class="menu-card">
            <h3>直近の活動ログ (最新10件)</h3>
            <ul class="simple-list">
                {% for log in recent_logs %}
                <li>
                    <div class="list-item-header">
                        <span>{{ log.log_date }}</span>
                        <span class="tag-badge">疲れ:{{ log.fatigue_level }} / 気分:{{ log.mood_level }}</span>
                    </div>
                    <small class="text-muted">{{ log.body_concern|default:"(悩みなし)" }}</small>
                </li>
                {% empty %}
                <li style="text-align: center; color: var(--color-text-muted);">ログなし</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_css %}
<style>
.user-info-grid p { margin: 0 0 12px; }
.form-check-label { display: flex; align-items: center; gap: 8px; font-weight: 600; }
.form-text { font-size: 0.875rem; color: var(--color-text-muted); margin: 4px 0 0 28px; }
.simple-list { list-style: none; padding: 0; margin: 0; }
.simple-list li { padding: 12px 0; border-bottom: 1px solid var(--color-border); }
.simple-list li:last-child { border-bottom: none; }
.list-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; font-weight: 600;}
</style>
{% endblock %}
