# コンディション・パートナー 要件定義書

## 1. プロジェクト概要
**アプリ名**: コンディション・パートナー (Condition Partner)

**プロジェクトの目的**: デスクワークや立ち仕事など、日々の疲れや体の不調を抱えるユーザーに対し、その日の体調や気分に合わせた最適な「運動メニュー（ストレッチ・筋トレなど）」を提案することで、無理なく健康習慣を継続できるようサポートするWebアプリケーションです。

## 2. 想定ユーザー
*   **ターゲット**: 20代〜50代の社会人、学生。特に運動不足を感じているが、何をすれば良いかわからない人、運動の継続に悩んでいる人。
*   **利用シーン**:
    *   仕事終わりの疲れた時
    *   朝起きてダルさを感じる時
    *   ちょっとした隙間時間にリフレッシュしたい時

## 3. 前提条件
*   **プラットフォーム**: Webブラウザ（PC、スマートフォン両対応）
*   **開発言語**: Python (Django), HTML/CSS, JavaScript
*   **データベース**: SQLite (開発用)

---

## 4. 機能一覧（超重要）

MUST = 必須
BEST = できたら追加

### 【ユーザー機能】
1.  **体調ログ入力機能**: 今日の「疲れレベル(1-5)」「気分レベル(1-5)」「体の悩み（肩こりなど）」を入力・記録する。MUST
2.  **パーソナル提案機能**: 入力された体調ログに基づき、最適な運動メニューを3つ提案する。
    *   *例: 「高疲労」かつ「肩こり」→ 座ったままできる肩甲骨ストレッチを提案* MUST
3.  **運動メニュー詳細表示**: 各メニューの効果、初心者向けのやり方（テキスト/HTML）、カテゴリ、タグを表示する。MUST
4.  **ルーティン管理機能**: 気に入った運動メニューを「ルーティン（お気に入り）」に追加・削除する。MUST
5.  **履歴確認機能**: 過去の自分の体調ログを一覧で確認できる。MUST

6.  **運動メニュー一覧・検索機能**: カテゴリ（ストレッチ、筋トレ等）やタグ、キーワードから登録されている全メニューを検索できる。BEST

### 【管理機能（管理者用）】
1.  **運動メニュー管理**: 運動メニューの追加・編集・削除（Django管理画面を使用）。
2.  **タグ管理**: 運動に紐づくタグの管理。
BEST
---

## 5. 画面構成（フロントエンド担当向け）

1.  **トップページ (`/`)**
    *   今日のコンディション入力フォーム
    *   （入力後）おすすめメニューの表示エリア
2.  **履歴一覧ページ (`/history/`)**
    *   過去の体調ログリスト（日付、気分、疲れ、悩み）
3.  **ルーティン一覧ページ (`/routines/`)**
    *   ユーザーが登録したルーティン（運動メニュー）のカード一覧
5.  **運動メニュー詳細ページ (`/exercises/<id>/`)**
    *   メニュー名、解説、タグ、ルーティン追加ボタン
以下BEST
4.  **運動メニュー一覧/検索ページ (`/exercises/`)**
    *   全メニューのリスト表示
    *   検索フォーム（キーワード、カテゴリフィルター）
---

## 6. データモデル概要（バックエンド担当向け）

| モデル名 | 役割 | 主なフィールド |
| :--- | :--- | :--- |
| **User** | ユーザー情報 | (Django標準機能を使用) |
| **ConditionLog** | 体調記録 | `user`(ユーザー), `log_date`(日付), `fatigue_level`(疲れ1-5), `mood_level`(気分1-5), `body_concern`(悩み) |
| **ExerciseMenu** | 運動メニュー | `name`(名称), `description`(説明), `category`(カテゴリ), `beginner_guide`(HTML解説), `tags`(タグ) |
| **Tag** | タグ | `name`(タグ名: #肩こり解消, #リフレッシュ 等) |
| **Routine** | ルーティン | `user`(ユーザー), `exercise`(メニュー), `added_at`(追加日時) |

---

## 7. API一覧・仕様（最重要）

フロントエンドとバックエンドはこのインターフェース（約束事）に従って通信を行います。

### 1. 運動提案API
*   **Endpoint**: `/api/recommend/`
*   **Method**: `POST`
*   **Request (入力)**:
    ```json
    {
      "fatigue_level": 4,   // 整数 (1-5)
      "mood_level": 2,      // 整数 (1-5)
      "body_concern": "肩"  // 文字列 (部分一致で使用)
    }
    ```
*   **Response (出力)**: おすすめメニュー(最大3件)のリスト
    ```json
    [
      {
        "id": 1,
        "name": "肩甲骨はがし",
        "category": "stretch",
        "description": "...",
        "tags": [{"name": "肩こり解消"}, {"name": "座ったまま"}]
      },
      ...
    ]
    ```
    *   ※提案なしで「休息」を促す場合は、`"rest_suggestion": true` を含むオブジェクトを返す。

### 2. ルーティン管理API
*   **Endpoint**: `/api/routines/<exercise_id>/`
*   **Method**: `POST` (追加) / `DELETE` (削除)
*   **Response**: `{"message": "..."}`

### 3. その他データ取得API
*   **履歴取得**: `GET /api/history/`
*   **全メニュー取得・検索**: `GET /api/exercises/?search=...&tags=...`
*   **メニュー詳細取得**: `GET /api/exercises/<id>/`

    *   ※フロントエンドからのAPIへの非同期通信はmain.jsに集約する